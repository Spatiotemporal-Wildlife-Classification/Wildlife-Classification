
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Pipelines - Spatiotemporal Wildlife Classification Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Spatiotemporal Wildlife Classification Docs" class="md-header__button md-logo" aria-label="Spatiotemporal Wildlife Classification Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spatiotemporal Wildlife Classification Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pipelines
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Spatiotemporal Wildlife Classification Docs" class="md-nav__button md-logo" aria-label="Spatiotemporal Wildlife Classification Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Spatiotemporal Wildlife Classification Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://spatiotemporal-wildlife-classification.github.io/" class="md-nav__link">
        Organization Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        Code Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../dataset/" class="md-nav__link">
        Dataset
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../cascading_ensemble_classifier/" class="md-nav__link">
        Novel Cascading Ensemble Classifier
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../results/" class="md-nav__link">
        Results
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../thesis/" class="md-nav__link">
        Thesis report
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines" class="md-nav__link">
    src.models.meta.pipelines
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.aggregate_data" class="md-nav__link">
    aggregate_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.dark_light_calc" class="md-nav__link">
    dark_light_calc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.day_night_calculation" class="md-nav__link">
    day_night_calculation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.decision_tree_data" class="md-nav__link">
    decision_tree_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.elevation_clean" class="md-nav__link">
    elevation_clean()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.general_pipeline" class="md-nav__link">
    general_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.land_mask" class="md-nav__link">
    land_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.localize_sunrise_sunset" class="md-nav__link">
    localize_sunrise_sunset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.neural_network_data" class="md-nav__link">
    neural_network_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.nn_binary_label_handling" class="md-nav__link">
    nn_binary_label_handling()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.nn_pipeline" class="md-nav__link">
    nn_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.north_south_calc" class="md-nav__link">
    north_south_calc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.ohe_labels" class="md-nav__link">
    ohe_labels()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.ohe_month" class="md-nav__link">
    ohe_month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.ohe_season" class="md-nav__link">
    ohe_season()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.over_sample" class="md-nav__link">
    over_sample()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.season_calc" class="md-nav__link">
    season_calc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.sub_species_detection" class="md-nav__link">
    sub_species_detection()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.tree_pipeline" class="md-nav__link">
    tree_pipeline()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.validation_set" class="md-nav__link">
    validation_set()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.xgb_data" class="md-nav__link">
    xgb_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.models.meta.pipelines.xgb_pipeline" class="md-nav__link">
    xgb_pipeline()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="pipelines">Pipelines</h1>


<div class="doc doc-object doc-module">


<a id="src.models.meta.pipelines"></a>
  <div class="doc doc-contents first">
  
      <p>This file establishes the dynamic pipelines used to produce training, test, and validation sets from the dataset.</p>
<p>A dynamic pipeline accepts processed data, and transforms it into: training data, test data, validation data with
the specified labels. The pipelines account for the variable taxonomic levels and the encoding of the location
feature, to produce the above transformations.</p>
<p>Note, the encoding of the location feature occurs within the pipeline processes. Please review the Silhouette
score documentation for further information on the process.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>root_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the project root.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>data_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to where the data is stored within the project</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to where models and validation data (if created) is saved. To train the models used in ensemble use <code>/models/meta/</code>. To metamodel notebook comparison use <code>/notebooks/meta_modelling/model_comparison_cache/</code>. For the notebook, please ensure the directory is made.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>validation_set_flag</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean flag indicating whether a validation set should be created and saved. The validation set is saved to save_path. Each file will have suffixx <code>_validation.csv</code></p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.aggregate_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aggregate_data</span><span class="p">(</span><span class="n">observation_file</span><span class="p">,</span> <span class="n">meta_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method aggregates the original observations with the collected metadata to form a single cohesive dataframe</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>observation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file name, that points to the file containing the processed iNaturalist observations</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>meta_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file name, that points to the file containing the metadata for the processed iNaturalist observations</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_data</span><span class="p">(</span><span class="n">observation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">meta_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method aggregates the original observations with the collected metadata to form a single cohesive dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        observation_file (str): The file name, that points to the file containing the processed iNaturalist observations</span>
<span class="sd">        meta_file (str): The file name, that points to the file containing the metadata for the processed iNaturalist observations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">root_path</span> <span class="o">+</span> <span class="n">data_path</span> <span class="o">+</span> <span class="n">observation_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Read in the csv files</span>
    <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">root_path</span> <span class="o">+</span> <span class="n">data_path</span> <span class="o">+</span> <span class="n">meta_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">obs_df</span> <span class="o">=</span> <span class="n">obs_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">,</span> <span class="s1">&#39;local_time_observed_at&#39;</span><span class="p">,</span> <span class="s1">&#39;positional_accuracy&#39;</span><span class="p">])</span>  <span class="c1"># Drop repeated/ non-essential columns</span>
    <span class="n">meta_df</span> <span class="o">=</span> <span class="n">meta_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">obs_df</span><span class="p">,</span> <span class="n">meta_df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Merge the two dataframes</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.dark_light_calc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dark_light_calc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs the dark/ light feature creation based on the time of observation and the sunrise &amp; sunset times</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with a new binary 'light' column</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dark_light_calc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs the dark/ light feature creation based on the time of observation and the sunrise &amp; sunset times</span>
<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with a new binary &#39;light&#39; column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;time_zone&#39;</span><span class="p">])</span>  <span class="c1"># Extract the timezone</span>
    <span class="n">sunrise_utc</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span>
    <span class="n">sunset_utc</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span>

    <span class="n">observ_time</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>  <span class="c1"># Place time zone info with utc (this is required to localize the timezone in the next step)</span>
    <span class="n">observ_time</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="p">)</span>  <span class="c1"># Generate the observed timezone in local time</span>

    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;light&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sunrise_utc</span> <span class="o">&lt;=</span> <span class="n">observ_time</span> <span class="o">&lt;=</span> <span class="n">sunset_utc</span><span class="p">)</span>  <span class="c1"># Logical operators cast into integer form create the binary light (1) or dark (0) value</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.day_night_calculation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">day_night_calculation</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method provides the overall process to create the light/ dark feature.</p>
<p>This method converts the time of observation, sunrise, and sunset into local times.
Local times are compared to determine light or dark.
The sunrise and sunset columns are removed as they are no longer required.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe with the additional light column, and the sunrise &amp; sunset columns removed.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">day_night_calculation</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method provides the overall process to create the light/ dark feature.</span>

<span class="sd">    This method converts the time of observation, sunrise, and sunset into local times.</span>
<span class="sd">    Local times are compared to determine light or dark.</span>
<span class="sd">    The sunrise and sunset columns are removed as they are no longer required.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame): The dataframe with the additional light column, and the sunrise &amp; sunset columns removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to datetime objects. Remove NaT values from resulting transformation</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">],</span>
                                   <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M&quot;</span><span class="p">,</span>
                                   <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">],</span>
                                  <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M&quot;</span><span class="p">,</span>
                                  <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">,</span> <span class="s1">&#39;sunset&#39;</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">localize_sunrise_sunset</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Localize sunrise and sunset times to be timezone aware</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dark_light_calc</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Dark/ light calc based on sunrise and sunset times</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">,</span> <span class="s1">&#39;sunset&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.decision_tree_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">decision_tree_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method to create the train/set/validation data to be used by the decision tree/ random forest/ Adaboost models</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all data for each observation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the file where the validation data will be stored. Also informs the name of the saved models.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The features in a form suitable for direct use within the models.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The labels for the corresponding observations as the correct taxonomic level.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decision_tree_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to create the train/set/validation data to be used by the decision tree/ random forest/ Adaboost models</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all data for each observation.</span>
<span class="sd">        taxon_target (str): The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</span>
<span class="sd">        validation_file (str): The name of the file where the validation data will be stored. Also informs the name of the saved models.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): The features in a form suitable for direct use within the models.</span>
<span class="sd">        y (Series): The labels for the corresponding observations as the correct taxonomic level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_means</span> <span class="o">=</span> <span class="n">silhouette_k_means</span><span class="o">.</span><span class="n">silhouette_process</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tree_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.elevation_clean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elevation_clean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs a logical check on each observation's elevation based on the land feature value.</p>
<p>The Open-Meteo API sets elevation to be 0m if the elevation is unknown.
If the elevation is 0m and the land value is 1 (indicating a terrestrial sighting), then the elevation is set to NaN value.
This NaN value will be modified within the pipeline with the species average elevation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row containing the 'land' column.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with the 'elevation' feature adjusted.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">elevation_clean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># If observation is terrestrial, 0.0m elevation requires modification</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs a logical check on each observation&#39;s elevation based on the land feature value.</span>

<span class="sd">    The Open-Meteo API sets elevation to be 0m if the elevation is unknown.</span>
<span class="sd">    If the elevation is 0m and the land value is 1 (indicating a terrestrial sighting), then the elevation is set to NaN value.</span>
<span class="sd">    This NaN value will be modified within the pipeline with the species average elevation</span>

<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row containing the &#39;land&#39; column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with the &#39;elevation&#39; feature adjusted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">land</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;land&#39;</span><span class="p">]</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">land</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">elevation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.general_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">general_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method performs general pipeline functions for all model types (Neural network, XGBoost, AdaBoost, Decision tree, Random Forest)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_means</code></td>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained K-means model that performs the location encoding</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dataframe containing cleaned, transformed, and new data features for further specified processing depending on the model.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">general_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">k_means</span><span class="p">:</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method performs general pipeline functions for all model types (Neural network, XGBoost, AdaBoost, Decision tree, Random Forest)</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">        k_means (KMeans): The trained K-means model that performs the location encoding</span>
<span class="sd">        taxon_target (str): The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame): A dataframe containing cleaned, transformed, and new data features for further specified processing depending on the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Data Cleaning</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geoprivacy&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_geoprivacy&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_id&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="s1">&#39;image_url&#39;</span><span class="p">])</span>  <span class="c1"># Remove non-essential columns</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;taxon_species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;public_positional_accuracy&#39;</span><span class="p">])</span>  <span class="c1"># Remove null species names and positional accuracies</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;public_positional_accuracy&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">40000</span><span class="p">]</span>  <span class="c1"># Positional Accuracy Restriction</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;public_positional_accuracy&#39;</span><span class="p">])</span>  <span class="c1"># Drop the public positional accuracy column</span>

    <span class="c1"># Transformations</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_species_detection</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Generate subspecies labels</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scientific_name&#39;</span><span class="p">])</span>  <span class="c1"># Drop the scientific name column</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">taxon_target</span><span class="p">)</span><span class="o">.</span><span class="n">common_name</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Remove species with less than 5 observations</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;location_cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_means</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]])</span>  <span class="c1"># Location encoding using K-means</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;land&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># All observations from dataset are terrestrial. For unknown datasets use the `land_mask()` method to automate the feature value</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">elevation_clean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Clean elevation values. In aquatic observations, the max elevation is sea level 0m</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;taxon_species_name&#39;</span><span class="p">)[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">))</span>  <span class="c1"># If elevation is missing, interpolate with mean species elevation</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hemisphere&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Northern/ Southern hemisphere feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span> <span class="c1"># Remove longitude and latitude columns</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S%z&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Datetime transform into datetime object</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>  <span class="c1"># Month feature</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;time_zone&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Local time zone hour feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">day_night_calculation</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># Day/ night feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">season_calc</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Season feature into categorical values</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ohe_season</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># One-hot-encode the categorical season values</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.land_mask" class="doc doc-heading">
<code class="highlight language-python"><span class="n">land_mask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method determines if the observation coordinates are terrestrial or aquatic in nature.</p>
<p>This method uses the Globe library to evaluate the location against a land mask.
If the observation is terrestrial a value of 1 is given. If not 0 is given.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row containing the 'latitude' and 'longitude' columns.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with an additional binary column value 'land'</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">land_mask</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method determines if the observation coordinates are terrestrial or aquatic in nature.</span>

<span class="sd">    This method uses the Globe library to evaluate the location against a land mask.</span>
<span class="sd">    If the observation is terrestrial a value of 1 is given. If not 0 is given.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row containing the &#39;latitude&#39; and &#39;longitude&#39; columns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with an additional binary column value &#39;land&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;land&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">globe</span><span class="o">.</span><span class="n">is_land</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.localize_sunrise_sunset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">localize_sunrise_sunset</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method localizes the sunrise and sunset times based on the time zone to aid in the light/ dark feature.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row containing the 'sunrise' and 'sunset' columns.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with the 'sunrise' and 'sunset' features adjusted.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">localize_sunrise_sunset</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method localizes the sunrise and sunset times based on the time zone to aid in the light/ dark feature.</span>
<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row containing the &#39;sunrise&#39; and &#39;sunset&#39; columns.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with the &#39;sunrise&#39; and &#39;sunset&#39; features adjusted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;time_zone&#39;</span><span class="p">])</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunrise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sunset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.neural_network_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">neural_network_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method to create the train/set/validation data to be used by the neural network model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all data for each observation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the file where the validation data will be stored. Also informs the name of the saved models.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The features in a form suitable for direct use within the models.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The labels for the corresponding observations as the correct taxonomic level.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>classes</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of classes data labels</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">neural_network_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to create the train/set/validation data to be used by the neural network model.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all data for each observation.</span>
<span class="sd">        taxon_target (str): The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</span>
<span class="sd">        validation_file (str): The name of the file where the validation data will be stored. Also informs the name of the saved models.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): The features in a form suitable for direct use within the models.</span>
<span class="sd">        y (Series): The labels for the corresponding observations as the correct taxonomic level.</span>
<span class="sd">        classes (int): The number of classes data labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_means</span> <span class="o">=</span> <span class="n">silhouette_k_means</span><span class="o">.</span><span class="n">silhouette_process</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="n">nn_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.nn_binary_label_handling" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nn_binary_label_handling</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method handles the OHE of a binary case to ensure that OHE values returned are of the form [1, 0] or [0, 1].</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The labels in the form of either 1 or 0 to be transformed into a binary OHE</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Returns a Series containing OHE labels of the form [1, 0] or [0, 1]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nn_binary_label_handling</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method handles the OHE of a binary case to ensure that OHE values returned are of the form [1, 0] or [0, 1].</span>

<span class="sd">    Args:</span>
<span class="sd">        y (Series): The labels in the form of either 1 or 0 to be transformed into a binary OHE</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Series): Returns a Series containing OHE labels of the form [1, 0] or [0, 1]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.nn_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nn_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs further data processing to structure and format it for use in the Neural Network model</p>
<p>This method performs similar processing steps to both the decision tree and XGBoost pipelines.
However, categorical variables are required to be OHE and the resulting features are normalized for use in the model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_means</code></td>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained K-means model that performs the location encoding</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of file to store validation data. Informs model naming as well.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation. These features are normalized.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The OHE encoding of the observation labels at the correct taxonomic level specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nn_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs further data processing to structure and format it for use in the Neural Network model</span>

<span class="sd">    This method performs similar processing steps to both the decision tree and XGBoost pipelines.</span>
<span class="sd">    However, categorical variables are required to be OHE and the resulting features are normalized for use in the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">        k_means (KMeans): The trained K-means model that performs the location encoding</span>
<span class="sd">        taxon_target (str): The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>
<span class="sd">        validation_file (str): The name of file to store validation data. Informs model naming as well.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation. These features are normalized.</span>
<span class="sd">        y (Series): The OHE encoding of the observation labels at the correct taxonomic level specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">general_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">)</span>

    <span class="c1"># Generate dummy variables for categorical features</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;location_cluster&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># OHE location cluster feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;hr&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># OHE hour feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;mnth&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># OHE month feature</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">,</span> <span class="s1">&#39;time_zone&#39;</span><span class="p">])</span>  <span class="c1"># Drop observed on column as date &amp; time transformations are complete</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">validation_set</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>  <span class="c1"># Create validation set for further testing</span>

    <span class="c1"># Data formatting</span>
    <span class="n">taxon_y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">]</span>  <span class="c1"># Retrieve labels at taxonomic target level</span>

    <span class="k">if</span> <span class="n">taxon_y</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>  <span class="c1"># If no taxonomic label is present, remove the observation</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">])</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">]</span>  <span class="c1"># Extract labels</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;taxon_kingdom_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_phylum_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_order_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_family_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_genus_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sub_species&#39;</span><span class="p">,</span> <span class="s1">&#39;common_name&#39;</span><span class="p">])</span>  <span class="c1"># Extract features only</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">over_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Resample dataset to reduce imbalance</span>

    <span class="n">y</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="n">ohe_labels</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># OHE labels</span>

    <span class="c1"># Normalize data using min-max approach</span>
    <span class="n">norm_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apparent_temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;apparent_temperature_max&#39;</span><span class="p">,</span> <span class="s1">&#39;apparent_temperature_min&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;cloudcover&#39;</span><span class="p">,</span> <span class="s1">&#39;cloudcover_high&#39;</span><span class="p">,</span> <span class="s1">&#39;cloudcover_low&#39;</span><span class="p">,</span> <span class="s1">&#39;cloudcover_mid&#39;</span><span class="p">,</span> <span class="s1">&#39;dewpoint_2m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;diffuse_radiation&#39;</span><span class="p">,</span> <span class="s1">&#39;direct_radiation&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;et0_fao_evapotranspiration_daily&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;et0_fao_evapotranspiration_hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;precipitation_hours&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;precipitation_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;rain&#39;</span><span class="p">,</span> <span class="s1">&#39;rain_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;relativehumidity_2m&#39;</span><span class="p">,</span> <span class="s1">&#39;shortwave_radiation&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;shortwave_radiation_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;snowfall&#39;</span><span class="p">,</span> <span class="s1">&#39;snowfall_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;soil_moisture_0_to_7cm&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;soil_moisture_28_to_100cm&#39;</span><span class="p">,</span> <span class="s1">&#39;soil_moisture_7_to_28cm&#39;</span><span class="p">,</span> <span class="s1">&#39;soil_temperature_0_to_7cm&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;soil_temperature_28_to_100cm&#39;</span><span class="p">,</span> <span class="s1">&#39;soil_temperature_7_to_28cm&#39;</span><span class="p">,</span> <span class="s1">&#39;surface_pressure&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;temperature_2m&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature_2m_max&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature_2m_min&#39;</span><span class="p">,</span> <span class="s1">&#39;vapor_pressure_deficit&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;winddirection_100m&#39;</span><span class="p">,</span> <span class="s1">&#39;winddirection_10m&#39;</span><span class="p">,</span> <span class="s1">&#39;winddirection_10m_dominant&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;windgusts_10m&#39;</span><span class="p">,</span> <span class="s1">&#39;windgusts_10m_max&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed_100m&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed_10m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;windspeed_10m_max&#39;</span><span class="p">]</span>
    <span class="n">X</span><span class="p">[</span><span class="n">norm_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">norm_columns</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.north_south_calc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">north_south_calc</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">seasons</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method determined the current season when provided with a month and a list of seasonal months.</p>
<p>Note, this method is used within the <code>season_calc()</code> method.</p>
<p>Args:
     month (int): The integer value of the month of sighting [1-12]
     seasons (list): The list of months seperated by season, starting with winter. Example of northern hemisphere [[12, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11]]</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The season categorical variable</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">north_south_calc</span><span class="p">(</span><span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seasons</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method determined the current season when provided with a month and a list of seasonal months.</span>

<span class="sd">     Note, this method is used within the `season_calc()` method.</span>

<span class="sd">     Args:</span>
<span class="sd">         month (int): The integer value of the month of sighting [1-12]</span>
<span class="sd">         seasons (list): The list of months seperated by season, starting with winter. Example of northern hemisphere [[12, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10, 11]]</span>

<span class="sd">    Returns:</span>
<span class="sd">        (str): The season categorical variable</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">seasons_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Winter&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Autumn&#39;</span><span class="p">}</span>
    <span class="n">season_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seasons</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">seasons</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">season_id</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">seasons_dict</span><span class="p">[</span><span class="n">season_id</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.ohe_labels" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ohe_labels</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method encodes the taxonomic labels in a One-hot-encoded format.</p>
<p>Special consideration is enforced for binary labels such that the resulting ohe labels are of the form [0, 1] or [1, 0]</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The categorical taxonomic labels</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>OHE taxonomic labels</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ohe_labels</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method encodes the taxonomic labels in a One-hot-encoded format.</span>

<span class="sd">    Special consideration is enforced for binary labels such that the resulting ohe labels are of the form [0, 1] or [1, 0]</span>

<span class="sd">    Args:</span>
<span class="sd">        y (Series): The categorical taxonomic labels</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Series): OHE taxonomic labels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>  <span class="c1"># OHE encode the labels</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">LabelBinarizer</span><span class="p">()</span>
    <span class="n">lb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">classes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Modification required if only two classes are present</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">nn_binary_label_handling</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">classes</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.ohe_month" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ohe_month</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method performs OHE on the month feature of each observation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ohe_month</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method performs OHE on the month feature of each observation</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>  <span class="c1"># Initialise the possible categories</span>
    <span class="n">cat_type</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">cats</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cat_type</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;szn&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Perform OHE</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.ohe_season" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ohe_season</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method OHE the season categorical feature</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe with the season feature OHE (this results in additional columns within the dataframe)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ohe_season</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method OHE the season categorical feature</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame): The dataframe with the season feature OHE (this results in additional columns within the dataframe)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Winter&#39;</span><span class="p">,</span> <span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="s1">&#39;Autumn&#39;</span><span class="p">]</span>  <span class="c1"># Season categorical variables to expect</span>
    <span class="n">cat_type</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">cats</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cat_type</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                        <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;szn&#39;</span><span class="p">,</span>
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">],</span>
                        <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.over_sample" class="doc doc-heading">
<code class="highlight language-python"><span class="n">over_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs oversampling on the dataset in order to provide a more balanced data distribution, to combat the tail-end distribution (characteristic of wildlife data).</p>
<p>Note, the oversampling aimed to increase the quantity of observations in minority classes to achieve a more even distribution.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataset's observation features to be used in model training and evaluation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The label for each observation (still categorical)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X_res</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The features dataset with additional observations due to the oversampling</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y_res</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An associated dataframe containing the observation labels, including for the additional observations created.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">over_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs oversampling on the dataset in order to provide a more balanced data distribution, to combat the tail-end distribution (characteristic of wildlife data).</span>

<span class="sd">    Note, the oversampling aimed to increase the quantity of observations in minority classes to achieve a more even distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">        X (DataFrame): The dataset&#39;s observation features to be used in model training and evaluation.</span>
<span class="sd">        y (Series): The label for each observation (still categorical)</span>

<span class="sd">    Returns:</span>
<span class="sd">         X_res (DataFrame): The features dataset with additional observations due to the oversampling</span>
<span class="sd">         y_res (Series): An associated dataframe containing the observation labels, including for the additional observations created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ros</span> <span class="o">=</span> <span class="n">RandomOverSampler</span><span class="p">(</span><span class="n">sampling_strategy</span><span class="o">=</span><span class="s1">&#39;minority&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">X_res</span><span class="p">,</span> <span class="n">y_res</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_res</span><span class="p">,</span> <span class="n">y_res</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.season_calc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">season_calc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method determines the season in which an observation occurred based on the month of observation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with a new season feature</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">season_calc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method determines the season in which an observation occurred based on the month of observation</span>

<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with a new season feature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hemisphere</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;hemisphere&#39;</span><span class="p">]</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>
    <span class="n">season</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">hemisphere</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Northern hemisphere</span>
        <span class="n">winter</span><span class="p">,</span> <span class="n">spring</span><span class="p">,</span> <span class="n">summer</span><span class="p">,</span> <span class="n">autumn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>  <span class="c1"># Order of months starting with winter season</span>
        <span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="n">winter</span><span class="p">,</span> <span class="n">spring</span><span class="p">,</span> <span class="n">summer</span><span class="p">,</span> <span class="n">autumn</span><span class="p">]</span>
        <span class="n">season</span> <span class="o">=</span> <span class="n">north_south_calc</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">seasons</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Southern hemisphere</span>
        <span class="n">winter</span><span class="p">,</span> <span class="n">spring</span><span class="p">,</span> <span class="n">summer</span><span class="p">,</span> <span class="n">autumn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># Order of months starting with winter seasons</span>
        <span class="n">seasons</span> <span class="o">=</span> <span class="p">[</span><span class="n">winter</span><span class="p">,</span> <span class="n">spring</span><span class="p">,</span> <span class="n">summer</span><span class="p">,</span> <span class="n">autumn</span><span class="p">]</span>
        <span class="n">season</span> <span class="o">=</span> <span class="n">north_south_calc</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">seasons</span><span class="p">)</span>

    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.sub_species_detection" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sub_species_detection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method uses the scientific name of observations to extract the subspecies name when there are more than
three words present (3 names describe a subspecies)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>This variable represents a dataframe row containing the 'scientific_name' column.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame row</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The method returns the dataframe row with an additional column value 'sub_species' if it could be extracted from the scientific name.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sub_species_detection</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method uses the scientific name of observations to extract the subspecies name when there are more than</span>
<span class="sd">    three words present (3 names describe a subspecies)</span>

<span class="sd">    Args:</span>
<span class="sd">        x (DataFrame row): This variable represents a dataframe row containing the &#39;scientific_name&#39; column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame row): The method returns the dataframe row with an additional column value &#39;sub_species&#39; if it could be extracted from the scientific name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;scientific_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>  <span class="c1"># Determine the number of names in the scientific name</span>
    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sub_species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Initialize the subspecies value</span>
    <span class="k">if</span> <span class="n">name_count</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;sub_species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;scientific_name&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.tree_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tree_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs further data processing to structure and format it for use in a decision tree, random forest and adaboost models.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_means</code></td>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained K-means model that performs the location encoding</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of file to store validation data. Informs model naming as well.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The categorical labels of the associated observations at the correct taxonomic level specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tree_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs further data processing to structure and format it for use in a decision tree, random forest and adaboost models.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">        k_means (KMeans): The trained K-means model that performs the location encoding</span>
<span class="sd">        taxon_target (str): The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>
<span class="sd">        validation_file (str): The name of file to store validation data. Informs model naming as well.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation.</span>
<span class="sd">        y (Series): The categorical labels of the associated observations at the correct taxonomic level specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">general_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">)</span>  <span class="c1"># Perform general pipeline</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">,</span> <span class="s1">&#39;time_zone&#39;</span><span class="p">])</span>  <span class="c1"># Drop observed on column as date &amp; time transformations are complete</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">validation_set</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>  <span class="c1"># Create validation set for further testing</span>

    <span class="c1"># Data formatting</span>
    <span class="n">taxon_y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">]</span>  <span class="c1"># Retrieve labels at taxonomic target level</span>

    <span class="k">if</span> <span class="n">taxon_y</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>  <span class="c1"># If no taxonomic label is present, remove the observation</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">])</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">]</span>  <span class="c1"># Extract labels</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;taxon_kingdom_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_phylum_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_order_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_family_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_genus_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sub_species&#39;</span><span class="p">,</span> <span class="s1">&#39;common_name&#39;</span><span class="p">])</span>  <span class="c1"># Extract features only</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">over_sample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Resample dataset to reduce imbalance</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.validation_set" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validation_set</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method creates a validation set from the provided dataframe for further model evaluation</p>
<p>The validation set comprises 20% of each class's composition from the dataframe.
The observations included in the validation set are removed from the dataframe.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>file_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the file in which the validation data will be stored.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe with the validation observations removed</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validation_set</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method creates a validation set from the provided dataframe for further model evaluation</span>

<span class="sd">    The validation set comprises 20% of each class&#39;s composition from the dataframe.</span>
<span class="sd">    The observations included in the validation set are removed from the dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">        taxon_target (str): The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>
<span class="sd">        file_name (str): The name of the file in which the validation data will be stored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (DataFrame): The dataframe with the validation observations removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">validation_set_flag</span><span class="p">:</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">taxon_target</span><span class="p">])</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 20% of each class goes to the validation set</span>
        <span class="n">grouped</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">root_path</span> <span class="o">+</span> <span class="n">save_path</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">)</span>  <span class="c1"># Save evaluation dataset</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># Remove validation observations from the current df through their index</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.xgb_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">xgb_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Method to create the train/set/validation data to be used by the XGBoost model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all data for each observation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the file where the validation data will be stored. Also informs the name of the saved models.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The features in a form suitable for direct use within the models.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The labels for the corresponding observations as the correct taxonomic level.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xgb_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to create the train/set/validation data to be used by the XGBoost model.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all data for each observation.</span>
<span class="sd">        taxon_target (str): The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</span>
<span class="sd">        validation_file (str): The name of the file where the validation data will be stored. Also informs the name of the saved models.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): The features in a form suitable for direct use within the models.</span>
<span class="sd">        y (Series): The labels for the corresponding observations as the correct taxonomic level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_means</span> <span class="o">=</span> <span class="n">silhouette_k_means</span><span class="o">.</span><span class="n">silhouette_process</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xgb_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.models.meta.pipelines.xgb_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">xgb_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs further data processing to structure and format it for use in the XGBoost model</p>
<p>This method makes use of the decison_tree_pipeline, simply encoding the labels in a One-Hot-Encoded (OHE) format</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataframe containing all observation data from the processed data directory.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_means</code></td>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained K-means model that performs the location encoding</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>validation_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of file to store validation data. Informs model naming as well.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The OHE encoding of the observation labels at the correct taxonomic level specified.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/models/meta/pipelines.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">xgb_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs further data processing to structure and format it for use in the XGBoost model</span>

<span class="sd">    This method makes use of the decison_tree_pipeline, simply encoding the labels in a One-Hot-Encoded (OHE) format</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe containing all observation data from the processed data directory.</span>
<span class="sd">        k_means (KMeans): The trained K-means model that performs the location encoding</span>
<span class="sd">        taxon_target (str): The taxonomic level at which to extract the taxon labels (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>
<span class="sd">        validation_file (str): The name of file to store validation data. Informs model naming as well.</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): A dataframe containing features in rows and observations in column ready for use as input features to the models for training and evaluation.</span>
<span class="sd">        y (Series): The OHE encoding of the observation labels at the correct taxonomic level specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tree_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">,</span> <span class="n">validation_file</span><span class="p">)</span>

    <span class="n">y</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="n">ohe_labels</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># OHE labels</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>