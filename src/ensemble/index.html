
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Ensemble - Spatiotemporal Wildlife Classification Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cascading-ensemble-classifier" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spatiotemporal Wildlife Classification Docs" class="md-header__button md-logo" aria-label="Spatiotemporal Wildlife Classification Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spatiotemporal Wildlife Classification Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ensemble
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spatiotemporal Wildlife Classification Docs" class="md-nav__button md-logo" aria-label="Spatiotemporal Wildlife Classification Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Spatiotemporal Wildlife Classification Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Code Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../dataset/" class="md-nav__link">
        Dataset
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cascading_ensemble_classifier/" class="md-nav__link">
        Novel Cascading Ensemble Classifier
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../results/" class="md-nav__link">
        Results
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../thesis/" class="md-nav__link">
        Thesis report
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cascading-ensemble-classifier" class="md-nav__link">
    Cascading Ensemble Classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble" class="md-nav__link">
    src.ensemble.ensemble
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.avg_multi_image_predictions" class="md-nav__link">
    avg_multi_image_predictions()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.ensemble_iteration" class="md-nav__link">
    ensemble_iteration()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.image_prediction" class="md-nav__link">
    image_prediction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.instantiate_save_file" class="md-nav__link">
    instantiate_save_file()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.load_next_cluster_model" class="md-nav__link">
    load_next_cluster_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.load_next_image_model" class="md-nav__link">
    load_next_image_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.load_next_meta_model" class="md-nav__link">
    load_next_meta_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.metadata_prediction" class="md-nav__link">
    metadata_prediction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.multiple_image_detections" class="md-nav__link">
    multiple_image_detections()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.predict" class="md-nav__link">
    predict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.preprocess_meta_data" class="md-nav__link">
    preprocess_meta_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.read_position" class="md-nav__link">
    read_position()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.taxon_weighted_decision" class="md-nav__link">
    taxon_weighted_decision()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.update_models" class="md-nav__link">
    update_models()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.ensemble.ensemble.update_position" class="md-nav__link">
    update_position()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Ensemble</h1>

<h2 id="cascading-ensemble-classifier">Cascading Ensemble Classifier</h2>


<div class="doc doc-object doc-module">


<a id="src.ensemble.ensemble"></a>
  <div class="doc doc-contents first">
  
      <p>This file forms the novel ensemble classifier.</p>
<p>The novel ensemble classifier is a combination of two cascading taxonomic classification trees, using
the metadata and image classifiers respectively at each parent node.
The two trees, form a combined result which best evaluates the optimal prediction based on the classifiers strengths
and when mitigating their weaknesses.</p>
<p>This classifier operates to classify the validation dataset.
The results serve as a comparison against baseline traditional image flat-classification methodologies.</p>
<p>Please note, the hierarchy is hard coded due to the difficulty in getting the metadata and image classification models
containing the same number of predicted children. This was hardcoded to achieve a result used to determine if this avenue of
classification was worth pursuing. It is, so this method will need to be refined to be scalable, efficient, and distributed to
be of use as a real-time classifier.
For now, this script operates as a Proof of concept on the database.
Adjust the hardcoded hierarchy if classifying wildlife on a different dataset.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to where the <code>validate.csv</code> dataset it. This is located in <code>data/obs_and_meta/processed/validation/</code></p></td>
        </tr>
        <tr>
          <td><code>results_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to where the results are stored. The results are stored within <code>notebooks/ensemble_model/ensemble_cache/</code> for easy visualizaiton in the Notebook.</p></td>
        </tr>
        <tr>
          <td><code>image_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the directory containing the validation images. The validation images and the data path sets are linked by observation id.</p></td>
        </tr>
        <tr>
          <td><code>model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the base directory containing image and metadata classification models.</p></td>
        </tr>
        <tr>
          <td><code>image_model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The specific directory containing all image models (using <code>model_path</code> as the base path)</p></td>
        </tr>
        <tr>
          <td><code>meta_model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The specific directory containing all metadata models (using <code>model_path</code> as the base path)</p></td>
        </tr>
        <tr>
          <td><code>cluster_model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The specific directory containing all K-means model used to encode the observation locations. (using <code>model_path</code> as a base path)</p></td>
        </tr>
        <tr>
          <td><code>base_image_classifier_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the base image classifier. (The root image classifier classifying Felidae and Elephantidae as child classes)</p></td>
        </tr>
        <tr>
          <td><code>base_meta_classifier_path</code></td>
          <td>
                <code> (str</code>
          </td>
          <td><p>The path to the base metadata classifier. (The root metadata classifier classifying Felidae and Elephantidae as child classes)</p></td>
        </tr>
        <tr>
          <td><code>base_cluster_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The path to the base K-means cluster model. (The models encoding the Felidae and Elephantidae possitions at the Family taxon level)</p></td>
        </tr>
        <tr>
          <td><code>multiple_detections_id</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>The list of possible image suffixes due to multiple sub-images per observation.</p></td>
        </tr>
        <tr>
          <td><code>img_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The size of the input images to the image classifier (528, 528, 3)</p></td>
        </tr>
        <tr>
          <td><code>taxonomic_levels</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>The list of taxonomic levels at which classification occurs in the dataset from family to subspecies in order.</p></td>
        </tr>
        <tr>
          <td><code>hierarchy</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>The taxonomic breakdown of the dataset.</p></td>
        </tr>
        <tr>
          <td><code>taxon_weighting</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>The weighting of the metadata model predictions. The inverse presents the image classification predictions. These values are presented after observing the metadata and image classification taxonomic level experiment results.</p></td>
        </tr>
    </tbody>
  </table>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.avg_multi_image_predictions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">avg_multi_image_predictions</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This model averages the predictions of sub-images to produce a single prediction per observation.</p>
<p>This method combines the sub-image wildlife predictions together, averages them, and constrains them to a valid
probability distribution to represent a softmax output, in order to provide a single prediction per
observation (original image).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>images</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of sub-image paths of which predictions will be combined.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>keras.<span title="keras.Sequential">Sequential</span></code>
          </td>
          <td><p>The image classification model to classify the sub-images as the correct taxonomic level.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>A summed, averaged, and constrained softmax output to provide a single image classification per observation.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">avg_multi_image_predictions</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This model averages the predictions of sub-images to produce a single prediction per observation.</span>

<span class="sd">    This method combines the sub-image wildlife predictions together, averages them, and constrains them to a valid</span>
<span class="sd">    probability distribution to represent a softmax output, in order to provide a single prediction per</span>
<span class="sd">    observation (original image).</span>

<span class="sd">    Args:</span>
<span class="sd">         images (list): A list of sub-image paths of which predictions will be combined.</span>
<span class="sd">         model (keras.Sequential): The image classification model to classify the sub-images as the correct taxonomic level.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): A summed, averaged, and constrained softmax output to provide a single image classification per observation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">output_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Determine the number of classes in the prediction</span>
    <span class="n">mean_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">output_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Generate a container for the mean prediction</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>  <span class="c1"># Loop through sub-images</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_img</span><span class="p">(</span><span class="n">image_path</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">target_size</span><span class="o">=</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">img_size</span><span class="p">))</span>  <span class="c1"># Format image</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">img_to_array</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">input_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">img</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">img</span>  <span class="c1"># Remove original image to save memory</span>

        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_arr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Classify image</span>
        <span class="n">mean_predictions</span> <span class="o">=</span> <span class="n">mean_predictions</span> <span class="o">+</span> <span class="n">prediction</span>  <span class="c1"># Sum with previous predictions</span>

    <span class="n">mean_predictions</span> <span class="o">=</span> <span class="n">mean_predictions</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>  <span class="c1"># Average predictions</span>
    <span class="k">return</span> <span class="n">mean_predictions</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mean_predictions</span><span class="p">)</span>  <span class="c1"># Return constrained prediction</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.ensemble_iteration" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ensemble_iteration</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs the cascading ensemble classification on the validation dataset.</p>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ensemble_iteration</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs the cascading ensemble classification on the validation dataset.&quot;&quot;&quot;</span>
    <span class="n">observation_no</span> <span class="o">=</span> <span class="n">read_position</span><span class="p">()</span>  <span class="c1"># Reads the row position to extract the observation to be classified.</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Read in the final test dataset</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_species_name&#39;</span><span class="p">])</span>  <span class="c1"># Remove any null values</span>

    <span class="k">if</span> <span class="n">observation_no</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># All data has been classified.</span>
        <span class="n">quit</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">observation_no</span><span class="p">:</span> <span class="n">observation_no</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Retrieve the observation row</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>  <span class="c1"># Performs the novel cascading ensemble classification on the observation</span>
        <span class="n">predict</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">update_position</span><span class="p">(</span><span class="n">observation_no</span><span class="p">)</span>  <span class="c1"># Update the position after classification</span>
    <span class="n">os</span><span class="o">.</span><span class="n">execv</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>  <span class="c1"># Clear all memory to allow space for next observation models to be loaded.</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.image_prediction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">image_prediction</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">image_model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method handles the detection of sub-images and their mean image prediction.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The observation id providing the unique based identifier for sub-images of the original observation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_model</code></td>
          <td>
                <code>keras.<span title="keras.Sequential">Sequential</span></code>
          </td>
          <td><p>The image classification model, for the current taxon parent node,</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>A summed, averaged, and constrained softmax output to provide a single image classification per observation.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">image_prediction</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_model</span><span class="p">:</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method handles the detection of sub-images and their mean image prediction.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int): The observation id providing the unique based identifier for sub-images of the original observation.</span>
<span class="sd">        image_model (keras.Sequential): The image classification model, for the current taxon parent node,</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): A summed, averaged, and constrained softmax output to provide a single image classification per observation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">multiple_image_detections</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">mean_img_prediction</span> <span class="o">=</span> <span class="n">avg_multi_image_predictions</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">image_model</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean_img_prediction</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.instantiate_save_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">instantiate_save_file</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method instantiates the file saving and documenting the predictions of the ensemble model,
its components, and the true labels.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dictwriter</code></td>          <td>
                <code><span title="csv.DictWriter">DictWriter</span></code>
          </td>
          <td><p>A dictionary writer object enabling dictionaries to be written to file f.</p></td>
        </tr>
        <tr>
<td><code>f</code></td>          <td>
                <code>file_handle</code>
          </td>
          <td><p>The file handle of the file to which the prediction data is being stored.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">instantiate_save_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method instantiates the file saving and documenting the predictions of the ensemble model,</span>
<span class="sd">    its components, and the true labels.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dictwriter (DictWriter): A dictionary writer object enabling dictionaries to be written to file f.</span>
<span class="sd">        f (file_handle): The file handle of the file to which the prediction data is being stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;ensemble_results.csv&#39;</span>
    <span class="n">headings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;taxonomic_level&#39;</span><span class="p">,</span> <span class="s1">&#39;joint_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;image_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;meta_prediction&#39;</span><span class="p">,</span> <span class="s1">&#39;true_label&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_path</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_path</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">dictwriter</span> <span class="o">=</span> <span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">headings</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_path</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">dictwriter</span> <span class="o">=</span> <span class="n">DictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">headings</span><span class="p">)</span>
        <span class="n">dictwriter</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dictwriter</span><span class="p">,</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.load_next_cluster_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_next_cluster_model</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method handles the loading of the correct K-means model, based on the decision</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>decision</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However "base" loads the root model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td><p>The pre-trained K-means model encoding the locations of the child nodes.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_next_cluster_model</span><span class="p">(</span><span class="n">decision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method handles the loading of the correct K-means model, based on the decision</span>

<span class="sd">    Args:</span>
<span class="sd">        decision (str): The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However &quot;base&quot; loads the root model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (KMeans): The pre-trained K-means model encoding the locations of the child nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span>  <span class="c1"># Root K-means encoding model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">base_cluster_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">decision</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Format taxon name to match model naming convention</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">cluster_model_path</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_xgb_k_means.sav&#39;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>  <span class="c1"># Load the model</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.load_next_image_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_next_image_model</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method handles the loading of the correct image model, based on the provided decision</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>decision</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However "base" loads the root model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>keras.<span title="keras.Sequential">Sequential</span></code>
          </td>
          <td><p>The pre-trained EfficientNet-B6 model classifying the children of the provided decision.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_next_image_model</span><span class="p">(</span><span class="n">decision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method handles the loading of the correct image model, based on the provided decision</span>

<span class="sd">    Args:</span>
<span class="sd">        decision (str): The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However &quot;base&quot; loads the root model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (keras.Sequential): The pre-trained EfficientNet-B6 model classifying the children of the provided decision.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span>  <span class="c1"># Root image classification model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">base_image_classifier_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">decision</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Format taxon name to match model naming convention</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">image_model_path</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_taxon_classifier&#39;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># Load the model</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.load_next_meta_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_next_meta_model</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method handles the loading of the correct metadata model, based on the provided decision</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>decision</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However "base" loads the root model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>xgboost</code>
          </td>
          <td><p>The pre-trained xgboost model classifying the children of the provided decision.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_next_meta_model</span><span class="p">(</span><span class="n">decision</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method handles the loading of the correct metadata model, based on the provided decision</span>

<span class="sd">    Args:</span>
<span class="sd">        decision (str): The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However &quot;base&quot; loads the root model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (xgboost): The pre-trained xgboost model classifying the children of the provided decision.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span>  <span class="c1"># Root metadata model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">base_meta_classifier_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">decision</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># Format taxon name to match model naming convention</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">meta_model_path</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_xgb_model.json&#39;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">()</span>  <span class="c1"># Load the model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.metadata_prediction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metadata_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">meta_model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method handles the formatting of metadata and the model prediction</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>X</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The input features to the metadata model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The unique id of each observation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>meta_model</code></td>
          <td>
                <code><span title="xgboost">xgb</span></code>
          </td>
          <td><p>The metadata model to predict the wildlife classes of the current taxon parent node.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>The metadata model softmax prediction.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">metadata_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">meta_model</span><span class="p">:</span> <span class="n">xgb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method handles the formatting of metadata and the model prediction</span>

<span class="sd">    Args:</span>
<span class="sd">        X (pd.DataFrame): The input features to the metadata model.</span>
<span class="sd">        index (int): The unique id of each observation.</span>
<span class="sd">        meta_model (xgb): The metadata model to predict the wildlife classes of the current taxon parent node.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): The metadata model softmax prediction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Access current row (current observation)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>  <span class="c1"># Convert meta-data sample to numpy array</span>
    <span class="n">meta_prediction</span> <span class="o">=</span> <span class="n">meta_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># Generate prediction</span>
    <span class="k">return</span> <span class="n">meta_prediction</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.multiple_image_detections" class="doc doc-heading">
<code class="highlight language-python"><span class="n">multiple_image_detections</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method gathers all sub-images per a single observation</p>
<p>Due to the image pre-processing multiple sub-images can occur. Each sub-image centers and focuses on a identified
wildlife individual. This method accumulated all file names based on the observation id.
Sub-images are structured in the following format: <code>&lt;id&gt;_&lt;alphabetical suffix&gt;.jpg</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>This is the unique id value of each observation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of file names leading to sub-images of the specified observation id (index)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multiple_image_detections</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method gathers all sub-images per a single observation</span>

<span class="sd">    Due to the image pre-processing multiple sub-images can occur. Each sub-image centers and focuses on a identified</span>
<span class="sd">    wildlife individual. This method accumulated all file names based on the observation id.</span>
<span class="sd">    Sub-images are structured in the following format: `&lt;id&gt;_&lt;alphabetical suffix&gt;.jpg`</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int): This is the unique id value of each observation.</span>
<span class="sd">    Returns:</span>
<span class="sd">        (list): A list of file names leading to sub-images of the specified observation id (index)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">possibility</span> <span class="ow">in</span> <span class="n">multiple_detections_id</span><span class="p">:</span>  <span class="c1"># Loop through the possible suffixes</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">possibility</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>  <span class="c1"># Generate a possible image name and path</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">image_path</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>  <span class="c1"># If the file exists, add it to images</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># If no file exists, exit the loop no further images will be found</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">images</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.predict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method performs a cascading prediction for the specified observation.</p>
<p>This method cascades from the family taxon to the subspecies taxon if labels are provided to that depth.
The method documents the component, combined classifications, and true labels at each taxon level for analysis.
The cascading process halts, when a miss-classification occurs.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>index</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The unique id of the current observation to be classified.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The dataframe containing all observation and metadata.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method performs a cascading prediction for the specified observation.</span>

<span class="sd">    This method cascades from the family taxon to the subspecies taxon if labels are provided to that depth.</span>
<span class="sd">    The method documents the component, combined classifications, and true labels at each taxon level for analysis.</span>
<span class="sd">    The cascading process halts, when a miss-classification occurs.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int): The unique id of the current observation to be classified.</span>
<span class="sd">        data (pd.DataFrame): The dataframe containing all observation and metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---Image index: &#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="s1">&#39; ---&#39;</span><span class="p">)</span>

    <span class="n">writer</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">instantiate_save_file</span><span class="p">()</span>

    <span class="n">current_level</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">]</span>  <span class="c1"># Generate base hierarchy level</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;base&#39;</span>  <span class="c1"># Current taxon label (parent taxon node)</span>

    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">taxonomic_levels</span><span class="p">:</span>  <span class="c1"># Decrease down the taxon levels predicting at each level, until a miss-classification or correctly classified</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&gt; &#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">current_level</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>  <span class="c1"># Prepare prediction labels</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2"> to be predicted&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># There exists only a single possibility in the taxon tree, no need to predict</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Single possibility: &#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="n">current_level</span> <span class="o">=</span> <span class="n">current_level</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>  <span class="c1"># Update the current level based on the label</span>
            <span class="k">continue</span>

        <span class="n">meta_model</span><span class="p">,</span> <span class="n">image_model</span><span class="p">,</span> <span class="n">cluster_model</span> <span class="o">=</span> <span class="n">update_models</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>  <span class="c1"># Update models based on next model</span>

        <span class="n">mean_img_prediction</span> <span class="o">=</span> <span class="n">image_prediction</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">image_model</span><span class="p">)</span>  <span class="c1"># Image prediction</span>

        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">preprocess_meta_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cluster_model</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>  <span class="c1"># Preprocess data for each taxon level</span>
        <span class="k">if</span> <span class="n">X</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>  <span class="c1"># Emergency case where null values may interrupt process</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Meta data contains null values &quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">meta_prediction</span> <span class="o">=</span> <span class="n">metadata_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">meta_model</span><span class="p">)</span>  <span class="c1"># Metadata prediction</span>

        <span class="n">joint_prediction</span> <span class="o">=</span> <span class="n">taxon_weighted_decision</span><span class="p">(</span><span class="n">meta_prediction</span><span class="p">,</span> <span class="n">mean_img_prediction</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>  <span class="c1"># Joint decision</span>
        <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">joint_prediction</span><span class="p">)])</span>

        <span class="n">current_level</span> <span class="o">=</span> <span class="n">current_level</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">joint_prediction</span><span class="p">)]]</span>  <span class="c1"># Update hierarchy level</span>

        <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>  <span class="c1"># There is no taxon label provided at this level. This is to accomodate for subspecies where not every observation has a label</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No label provided at </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="n">true_label</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># True label</span>

        <span class="c1"># Display</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean image prediction: &#39;</span><span class="p">,</span> <span class="n">mean_img_prediction</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Meta image prediction: &#39;</span><span class="p">,</span> <span class="n">meta_prediction</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Joint prediction: &#39;</span><span class="p">,</span> <span class="n">joint_prediction</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Predicted label: &#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;True label: &#39;</span><span class="p">,</span> <span class="n">true_label</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                   <span class="s1">&#39;taxonomic_level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
                   <span class="s1">&#39;joint_prediction&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
                   <span class="s1">&#39;image_prediction&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mean_img_prediction</span><span class="p">)],</span>
                   <span class="s1">&#39;meta_prediction&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">meta_prediction</span><span class="p">)],</span>
                   <span class="s1">&#39;true_label&#39;</span><span class="p">:</span> <span class="n">true_label</span><span class="p">}</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># Save results to file</span>

        <span class="k">del</span> <span class="n">meta_model</span>  <span class="c1"># Clear memory so the next model can be loaded</span>
        <span class="k">del</span> <span class="n">cluster_model</span>
        <span class="k">del</span> <span class="n">image_model</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">true_label</span> <span class="o">!=</span> <span class="n">label</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Classification Mismatch&#39;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.preprocess_meta_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preprocess_meta_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k_means</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method processes and formats the metadata for model prediction, based on the taxon target the
location encoding K-means model.</p>
<p>This processing pipeline is essential for each dataset, as it processes and prepares the data based on the taxonomic level
and the models pre-trained to suit the taxon level.
This method looks similar to the data pipelines, but is modified due to the validation dataset already being processed.
This pipeline formats the data into the required form for use.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>The dataframe to be processed into features and labels.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_means</code></td>
          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td><p>The pre-trained location encoding model. This is trained based on the appropriate taxon parent node and taxon target, to be most effective within this dataset.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_target</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>X</code></td>          <td>
                <code>DataFrame</code>
          </td>
          <td><p>The dataframe of features to be used by the metadata models</p></td>
        </tr>
        <tr>
<td><code>y</code></td>          <td>
                <code>Series</code>
          </td>
          <td><p>The labels of each observation, extracted at the taxonomic target level.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_meta_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">k_means</span><span class="p">:</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">taxon_target</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method processes and formats the metadata for model prediction, based on the taxon target the</span>
<span class="sd">    location encoding K-means model.</span>

<span class="sd">    This processing pipeline is essential for each dataset, as it processes and prepares the data based on the taxonomic level</span>
<span class="sd">    and the models pre-trained to suit the taxon level.</span>
<span class="sd">    This method looks similar to the data pipelines, but is modified due to the validation dataset already being processed.</span>
<span class="sd">    This pipeline formats the data into the required form for use.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): The dataframe to be processed into features and labels.</span>
<span class="sd">        k_means (KMeans): The pre-trained location encoding model. This is trained based on the appropriate taxon parent node and taxon target, to be most effective within this dataset.</span>
<span class="sd">        taxon_target (str): The taxonomic target level, to extract the correct labels (taxon_family_name, taxon_genus_name, taxon_species_name, subspecies)</span>

<span class="sd">    Returns:</span>
<span class="sd">        X (DataFrame): The dataframe of features to be used by the metadata models</span>
<span class="sd">        y (Series): The labels of each observation, extracted at the taxonomic target level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geoprivacy&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_geoprivacy&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_id&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;observed_on_y&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="s1">&#39;image_url&#39;</span><span class="p">,</span> <span class="s1">&#39;local_time_observed_at&#39;</span><span class="p">,</span> <span class="s1">&#39;positional_accuracy&#39;</span><span class="p">])</span>  <span class="c1"># Remove non-essential columns</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;public_positional_accuracy&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">40000</span><span class="p">]</span>  <span class="c1"># Positional Accuracy Restriction</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;public_positional_accuracy&#39;</span><span class="p">])</span>

    <span class="c1"># Generate subspecies and drop scientific name</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sub_species_detection</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scientific_name&#39;</span><span class="p">])</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;location_cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_means</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]])</span>  <span class="c1"># Location encoding using K-means</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;land&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># All observations from dataset are terrestrial. For unknown datasets use the `land_mask()` method to automate the feature value</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">elevation_clean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># Clean elevation values. In aquatic observations, the max elevation is sea level 0m</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;taxon_species_name&#39;</span><span class="p">)[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">))</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hemisphere&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Northern and Southern Hemisphere OHE</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S%z&quot;</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Datetime transform into datetime object</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>  <span class="c1"># Month Feature</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;time_zone&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Hour Feature (local time)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">day_night_calculation</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># Day/Night Feature</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">season_calc</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Season feature into categorical values</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ohe_season</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># One-hot-encode the categorical season values</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;observed_on&#39;</span><span class="p">,</span> <span class="s1">&#39;time_zone&#39;</span><span class="p">])</span>  <span class="c1"># Drop observed on column as date &amp; time transformations are complete</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">taxon_target</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;taxon_kingdom_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_phylum_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_order_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_family_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;taxon_genus_name&#39;</span><span class="p">,</span> <span class="s1">&#39;taxon_species_name&#39;</span><span class="p">,</span> <span class="s1">&#39;sub_species&#39;</span><span class="p">,</span> <span class="s1">&#39;common_name&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.read_position" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_position</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method reads the position from the <code>position.csv</code> as a way of keeping track of which observation it is
currently on in the validation dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>int</code>
          </td>
          <td><p>The row location of the current observation to classify.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_position</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method reads the position from the `position.csv` as a way of keeping track of which observation it is</span>
<span class="sd">    currently on in the validation dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The row location of the current observation to classify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;position.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.taxon_weighted_decision" class="doc doc-heading">
<code class="highlight language-python"><span class="n">taxon_weighted_decision</span><span class="p">(</span><span class="n">meta_prediction</span><span class="p">,</span> <span class="n">image_prediction</span><span class="p">,</span> <span class="n">taxon_level</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method weights the metadata and image predictions based on the determined taxonomic weighting to produce
a single softmax output to correctly predict the wildlife taxon</p>
<p>The output is constrained to a valid probability distribution to match a softmax output.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>meta_prediction</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of metadata class probabilities. Note, the classes must match the image prediction</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_prediction</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of image class probabilities. Note, the classes must match the meta prediction.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>taxon_level</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Specification of the taxon level, to specify the component weighting. (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>A constrained softmax output constructed from the weighted influence of the individual metadata and image prediction components.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">taxon_weighted_decision</span><span class="p">(</span><span class="n">meta_prediction</span><span class="p">,</span> <span class="n">image_prediction</span><span class="p">,</span> <span class="n">taxon_level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method weights the metadata and image predictions based on the determined taxonomic weighting to produce</span>
<span class="sd">    a single softmax output to correctly predict the wildlife taxon</span>

<span class="sd">    The output is constrained to a valid probability distribution to match a softmax output.</span>

<span class="sd">    Args:</span>
<span class="sd">        meta_prediction (list): A list of metadata class probabilities. Note, the classes must match the image prediction</span>
<span class="sd">        image_prediction (list): A list of image class probabilities. Note, the classes must match the meta prediction.</span>
<span class="sd">        taxon_level (str): Specification of the taxon level, to specify the component weighting. (taxon_family_name, taxon_genus_name, taxon_species_name, sub_species)</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): A constrained softmax output constructed from the weighted influence of the individual metadata and image prediction components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta_weighting</span> <span class="o">=</span> <span class="n">taxon_weighting</span><span class="p">[</span><span class="n">taxon_level</span><span class="p">]</span>  <span class="c1"># Metadata prediction weight</span>
    <span class="n">image_weighting</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">meta_weighting</span>  <span class="c1"># Image prediction weight is the inverse</span>

    <span class="n">weighted_meta</span> <span class="o">=</span> <span class="n">meta_prediction</span> <span class="o">*</span> <span class="n">meta_weighting</span>  <span class="c1"># Apply weightings</span>
    <span class="n">weighted_image</span> <span class="o">=</span> <span class="n">image_prediction</span> <span class="o">*</span> <span class="n">image_weighting</span>

    <span class="n">combined</span> <span class="o">=</span> <span class="n">weighted_meta</span> <span class="o">+</span> <span class="n">weighted_image</span>  <span class="c1"># Combined and constrain weightings</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>  <span class="c1"># Ensure a valid probability distribution</span>
    <span class="k">return</span> <span class="n">combined</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.update_models" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_models</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method serves to update all three models, based on the provided taxon label</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>label</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However "base" loads the root model.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>meta_model</code></td>          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td><p>The metadata classification model for the label taxon parent node.</p></td>
        </tr>
        <tr>
<td><code>image_model</code></td>          <td>
                <code>keras.<span title="keras.Sequential">Sequential</span></code>
          </td>
          <td><p>The image classification model for the label taxon parent node.</p></td>
        </tr>
        <tr>
<td><code>cluster_model</code></td>          <td>
                <code><span title="sklearn.cluster.KMeans">KMeans</span></code>
          </td>
          <td><p>The K-means encoding model for the children of the label taxon parent node.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_models</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method serves to update all three models, based on the provided taxon label</span>

<span class="sd">    Args:</span>
<span class="sd">        label (str): The taxon label instructing the method which model to load. This is ordinarily the name of the taxonomic child. However &quot;base&quot; loads the root model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        meta_model (KMeans): The metadata classification model for the label taxon parent node.</span>
<span class="sd">        image_model (keras.Sequential): The image classification model for the label taxon parent node.</span>
<span class="sd">        cluster_model (KMeans): The K-means encoding model for the children of the label taxon parent node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">meta_model</span> <span class="o">=</span> <span class="n">load_next_meta_model</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">image_model</span> <span class="o">=</span> <span class="n">load_next_image_model</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">cluster_model</span> <span class="o">=</span> <span class="n">load_next_cluster_model</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">meta_model</span><span class="p">,</span> <span class="n">image_model</span><span class="p">,</span> <span class="n">cluster_model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.ensemble.ensemble.update_position" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_position</span><span class="p">(</span><span class="n">prev_position</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This method updates the saved row location of the observation to point to the next observation from previous.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>prev_position</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The row location of the previous observation that has been classified.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/ensemble/ensemble.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="n">prev_position</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This method updates the saved row location of the observation to point to the next observation from previous.</span>

<span class="sd">    Args:</span>
<span class="sd">        prev_position (int): The row location of the previous observation that has been classified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;position.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prev_position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>